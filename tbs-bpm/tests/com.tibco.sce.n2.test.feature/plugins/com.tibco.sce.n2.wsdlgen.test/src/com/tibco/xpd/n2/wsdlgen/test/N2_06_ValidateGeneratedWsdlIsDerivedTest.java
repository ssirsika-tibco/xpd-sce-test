/**
 * Copyright (c) TIBCO Software Inc 2004-2009. All rights reserved.
 */
package com.tibco.xpd.n2.wsdlgen.test;

import org.eclipse.core.resources.IFile;
import org.eclipse.core.resources.IncrementalProjectBuilder;
import org.eclipse.core.resources.ResourcesPlugin;
import org.eclipse.core.runtime.CoreException;
import org.eclipse.core.runtime.NullProgressMonitor;

import com.tibco.xpd.core.test.util.TestResourceInfo;
import com.tibco.xpd.core.test.util.TestUtil;
import com.tibco.xpd.core.test.validations.ValidationsTestProblemMarkerInfo;
import com.tibco.xpd.n2.test.core.validation.AbstractN2BaseValidationTest;

/**
 * ValidateGeneratedWsdlIsDerivedTest
 * <p>
 * ValidateGeneratedWsdlIsDerivedTest - Test selected validations are correctly
 * raised.
 * </p>
 * <p>
 * Generated by: createBaseTest.javajet
 * </p>
 * 
 * As part of XPD-533 - we now check that generated wsdl in generated services
 * has the derived flag on, and check for non-generated services in generated
 * services folder and generated outside of generated services
 * 
 * @author
 * @since
 */
public class N2_06_ValidateGeneratedWsdlIsDerivedTest extends
        AbstractN2BaseValidationTest {

    public N2_06_ValidateGeneratedWsdlIsDerivedTest() {
        super(true);
    }

    /**
     * ValidateGeneratedWsdlIsDerivedTest
     * 
     * @throws Exception
     */
    public void testValidateGeneratedWsdlIsDerivedTest() throws Exception {
        doTestValidations();
        return;
    }

    @Override
    protected void setUp() throws Exception {
        super.setUp();

        /*
         * After building we need to unset the derived flag on the WSDL and then
         * touch it to get it revalidated.
         */

        IFile generatedWsdl =
                getTestFile("ValidateGeneratedWsdlIsDerivedTest.wsdl"); //$NON-NLS-1$
        generatedWsdl.setDerived(false);
        generatedWsdl.touch(null);

        try {
            ResourcesPlugin.getWorkspace()
                    .build(IncrementalProjectBuilder.INCREMENTAL_BUILD,
                            new NullProgressMonitor());

            TestUtil.waitForJobsEx(ResourcesPlugin.FAMILY_AUTO_BUILD);

        } catch (CoreException e) {
            e.printStackTrace();
            fail("Inremental Build after WSDL touch Failed: " + e.getMessage()); //$NON-NLS-1$
        }

        return;
    }

    @Override
    protected ValidationsTestProblemMarkerInfo[] getValidationProblemMarkerInfos() {
        ValidationsTestProblemMarkerInfo[] markerInfos =
                new ValidationsTestProblemMarkerInfo[] {

                // Kapil: The validation in this test are no longer present,
                // commenting it out.
                //
                // new ValidationsTestProblemMarkerInfo(
                //                                "/VGenWsdlDerTest/Generated Services/ValidateGeneratedWsdlIsDerivedTest.wsdl", //$NON-NLS-1$ 
                //                                "wsdlgen.nonDerivedGeneratedWsdlInGenServices", //$NON-NLS-1$ 
                //                                "/", //$NON-NLS-1$ 
                //                                "WSDL 1.1 : The generated WSDL ValidateGeneratedWsdlIsDerivedTest.wsdl should be flagged as derived (any changes will be overwritten on clean build). (http://www.tibco.com/bs3.0/_1ohDkEhnEd-HtfX1khV6Wg)", //$NON-NLS-1$ 
                //                                "Set generated WSDL to 'derived'."), //$NON-NLS-1$ 
                //
                // new ValidationsTestProblemMarkerInfo(
                //                                "/VGenWsdlDerTest/Process Packages/ValidateGeneratedWsdlIsDerivedTest.xpdl", //$NON-NLS-1$ 
                //                                "bpmn.dev.wsdlGenNotDerived", //$NON-NLS-1$ 
                //                                "_1ohDkEhnEd-HtfX1khV6Wg", //$NON-NLS-1$ 
                //                                "BPMN : The WSDL file will not be updated with the XPDL changes because it is not marked as Derived. (ValidateGeneratedWsdlIsDerivedTest)", //$NON-NLS-1$ 
                //                                ""), //$NON-NLS-1$ 
                //
                // new ValidationsTestProblemMarkerInfo(
                //                                "/VGenWsdlDerTest/Service Descriptors/UC1CaWebServiceInvoke.wsdl", //$NON-NLS-1$ 
                //                                "wsdlgen.generatedWsdlOutsideGenServices", //$NON-NLS-1$ 
                //                                "/", //$NON-NLS-1$ 
                //                                "WSDL 1.1 : The WSDL UC1CaWebServiceInvoke.wsdl appears to be have been auto-generated but is not in the Generated Services folder.  (http://www.tibco.com/bs3.0/_-HuaMVclEd6o6c8LFxdK_A)", //$NON-NLS-1$ 
                //                                "Remove the auto-generated indicator attribute from WSDL."), //$NON-NLS-1$ 

                };
        return markerInfos;
    }

    @Override
    protected String getTestName() {
        return "ValidateGeneratedWsdlIsDerivedTest"; //$NON-NLS-1$
    }

    @Override
    protected String getTestPlugInId() {
        return WSDLGenTestPluginActivator.PLUGIN_ID;
    }

    @Override
    protected TestResourceInfo[] getTestResources() {
        TestResourceInfo[] testResources =
                new TestResourceInfo[] {
                        new TestResourceInfo(
                                "resources/VGenWsdlIsDerTest", "VGenWsdlDerTest/Generated Services{wsdl}/AddressLookupAppService.wsdl"), //$NON-NLS-1$ //$NON-NLS-2$
                        new TestResourceInfo(
                                "resources/VGenWsdlIsDerTest", "VGenWsdlDerTest/Generated Services{wsdl}/ValidateGeneratedWsdlIsDerivedTest.wsdl"), //$NON-NLS-1$ //$NON-NLS-2$
                        new TestResourceInfo(
                                "resources/VGenWsdlIsDerTest", "VGenWsdlDerTest/Process Packages{processes}/ValidateGeneratedWsdlIsDerivedTest.xpdl"), //$NON-NLS-1$ //$NON-NLS-2$
                        new TestResourceInfo(
                                "resources/VGenWsdlIsDerTest", "VGenWsdlDerTest/Service Descriptors{wsdl}/UC1CaWebServiceInvoke.wsdl"), //$NON-NLS-1$ //$NON-NLS-2$
                };

        return testResources;
    }

}
