/**
 * Copyright (c) TIBCO Software Inc 2004-2009. All rights reserved.
 */
package com.tibco.xpd.n2.mappings.validation.newtests;

import java.util.List;

import org.eclipse.core.resources.IFile;

import com.tibco.xpd.core.test.util.TestResourceInfo;
import com.tibco.xpd.core.test.validations.ValidationsTestProblemMarkerInfo;
import com.tibco.xpd.n2.test.core.validation.AbstractN2BaseValidationTest;

/**
 * N2WebSvcJavaScriptValidMappingsTest
 * <p>
 * N2WebSvcJavaScriptValidMappingsTest - Test selected validations are correctly
 * raised.
 * </p>
 * <p>
 * Generated by: createBaseTest.javajet
 * </p>
 * 
 * Tests that none of the new validaiton rules are raised unnecessarily.
 * 
 * @author aallway
 * @since 3.4.2
 */
public class N2_31_N2WebSvcJavaScriptValidMappingsTest extends
        AbstractN2BaseValidationTest {
    private static String[] ISSUE_ID_EXTRACTS =
            new String[] { "abstractMappingRule\\..*" }; //$NON-NLS-1$

    public N2_31_N2WebSvcJavaScriptValidMappingsTest() {
        super(true);
    }

    /**
     * Override to check against specific validations being raised.
     */
    @Override
    protected void doTestValidations() throws Exception {
        String failures = ""; //$NON-NLS-1$
        TestResourceInfo[] testResources = getTestResources();

        for (TestResourceInfo testResourceInfo : testResources) {
            IFile testFile = testResourceInfo.getTestFile();
            if (testFile == null || !testFile.exists()) {
                fail("Unable to find resource '" + testResourceInfo.getTestFilePath() //$NON-NLS-1$
                        + "' for  test problem markers"); //$NON-NLS-1$
            }

            List<ValidationsTestProblemMarkerInfo> problemMarkers =
                    getProblemMarkers(testFile);
            for (ValidationsTestProblemMarkerInfo markerInfo : problemMarkers) {
                String problemId = markerInfo.getProblemId();

                for (String issueIdPattern : ISSUE_ID_EXTRACTS) {
                    if (problemId.matches(issueIdPattern)) {
                        failures +=
                                String
                                        .format("Expected no occurrences of issue '%s'\n  (matches issue id pattern '%s'; found in resource: '%s').\n", //$NON-NLS-1$
                                                markerInfo.getProblemText(),
                                                issueIdPattern,
                                                testResourceInfo
                                                        .getTestFilePath());
                    }
                }
            }
        }

        if (failures.length() > 0) {
            fail(failures);
        }
        return;
    }

    /**
     * N2WebSvcJavaScriptValidMappingsTest
     * 
     * @throws Exception
     */
    public void testN2WebSvcJavaScriptValidMappingsTest() throws Exception {
        doTestValidations();
        return;
    }

    @Override
    protected ValidationsTestProblemMarkerInfo[] getValidationProblemMarkerInfos() {
        ValidationsTestProblemMarkerInfo[] markerInfos =
                new ValidationsTestProblemMarkerInfo[] {

                };
        return markerInfos;
    }

    @Override
    protected String getTestName() {
        return "N2WebSvcJavaScriptValidMappingsTest"; //$NON-NLS-1$
    }

    @Override
    protected String getTestPlugInId() {
        return "com.tibco.xpd.n2.mappings.validation.test"; //$NON-NLS-1$
    }

    @Override
    protected TestResourceInfo[] getTestResources() {
        TestResourceInfo[] testResources =
                new TestResourceInfo[] {
                        new TestResourceInfo(
                                "resources/N2 WebSvc JavaScript Valid Mappings", "TestInvokeWebSvcJavaScriptValidMappings/Process Packages{processes}/TestInvokeWebSvcJavaScriptValidMappings.xpdl"), //$NON-NLS-1$ //$NON-NLS-2$
                        new TestResourceInfo(
                                "resources/N2 WebSvc JavaScript Valid Mappings", "TestInvokeWebSvcJavaScriptValidMappings/Service Descriptors{wsdl}/NewWSDLFile.wsdl"), //$NON-NLS-1$ //$NON-NLS-2$
                };

        return testResources;
    }

}
