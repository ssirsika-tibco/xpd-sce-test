<?xml version="1.0" encoding="UTF-8"?>
<bpws:process exitOnStandardFault="no" name="SimpleProcProcess"
    suppressJoinFailure="yes" tibex:bxVersion="11.0.0"
    tibex:explicitCompensation="yes"
    tibex:xpdlId="_YtKpwIHzEemwcs8vYEbmtg"
    xmlns:bpws="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:ns="http://www.tibco.com/rsbtPassThrough/"
    xmlns:tibex="http://www.tibco.com/bpel/2007/extensions" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <tibex:VariableDescriptor type="PersistentBatching">
        <task name="EmailCustomers">
            <startingVariables>
                <variable>TextProcField</variable>
            </startingVariables>
        </task>
    </tibex:VariableDescriptor>
    <bpws:documentation>*** Generated by TIBCO Business Studio.</bpws:documentation>
    <bpws:import importType="http://schemas.xmlsoap.org/wsdl/"
        location="TIBCO-REST-PassThrough.wsdl" namespace="http://www.tibco.com/rsbtPassThrough/"/>
    <bpws:partnerLinks>
        <bpws:partnerLink name="_6p514IXhEemreJ7fmIXVPg"
            partnerLinkType="RESTPassThroughService_PLT" partnerRole="RESTPassThroughServiceProvider"/>
    </bpws:partnerLinks>
    <bpws:variables>
        <bpws:variable name="TextProcField"
            tibex:xpdlId="_fM8woIHzEemwcs8vYEbmtg" type="xsd:string"/>
        <bpws:variable name="NumProcField1"
            tibex:xpdlId="_qjnnwIIQEemKl_kc4dKXjw" type="xsd:double"/>
        <bpws:variable name="NumProcField2"
            tibex:xpdlId="_Ol0qsIIREemKl_kc4dKXjw" type="xsd:double"/>
        <bpws:variable name="NumProcField3"
            tibex:xpdlId="_ROmq0IIREemKl_kc4dKXjw" type="xsd:double"/>
        <bpws:variable name="NumProcField4"
            tibex:xpdlId="_Ni2bsIIaEem5idng-Y-hlA" type="xsd:double"/>
    </bpws:variables>
    <bpws:extensions>
        <bpws:extension mustUnderstand="yes" namespace="http://www.tibco.com/bpel/2007/extensions"/>
    </bpws:extensions>
    <bpws:eventHandlers/>
    <bpws:flow name="_BX_flow_cLBWsIaTEem12q-IJ62Opg">
        <bpws:links>
            <bpws:link name="GetcustomerGETCustomers to EmailCustomers" tibex:xpdlId="_uzeBIIXmEemreJ7fmIXVPg"/>
            <bpws:link name="StartEvent to GetcustomerGETCustomers" tibex:xpdlId="_c5zCRYHzEemwcs8vYEbmtg"/>
            <bpws:link name="EmailCustomers to EndEvent" tibex:xpdlId="_c5zCRoHzEemwcs8vYEbmtg"/>
        </bpws:links>
        <bpws:extensionActivity>
            <tibex:receiveEvent createInstance="yes" eventTimeout="0"
                name="StartEvent" tibex:type="startEvent"
                tibex:xpdlId="_c5zCQoHzEemwcs8vYEbmtg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:sources>
                    <bpws:source linkName="StartEvent to GetcustomerGETCustomers"/>
                </bpws:sources>
                <tibex:eventSource>
                    <tibex:startEvent eventType="Default"/>
                </tibex:eventSource>
            </tibex:receiveEvent>
        </bpws:extensionActivity>
        <bpws:invoke name="GetcustomerGETCustomers" operation="invoke"
            partnerLink="_6p514IXhEemreJ7fmIXVPg"
            portType="ns:RESTPassThroughService"
            tibex:migrationAllowed="yes" tibex:type="serviceTask" tibex:xpdlId="_c5zCQ4HzEemwcs8vYEbmtg">
            <tibex:restResponseScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Get response data.
var REST_STATUS_CODE = REST_RESPONSE.getStatus();
var REST_PAYLOAD = null;

REST_PAYLOAD = REST_RESPONSE.getData();


]]></tibex:restResponseScript>
            <tibex:restRequestScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[// Declare local variables.
var REST_PATH_customerId;
var REST_PAYLOAD;

// Map from 'NumProcField1' to 'Path Parameters.customerId'
REST_PATH_customerId = (NumProcField1 != null) ? (typeof NumProcField1 == 'object' ? NumProcField1.intValue() : NumProcField1) : null;

// Build request URI.
function __filterQueryParams(__all_params){
    return __all_params.filter(function(__filter_param){
        return __filter_param.mandatory||eval(__filter_param.path)!=null;
    });
}
function __encodeQueryParams(__all_params){
    var __filtered_params = __filterQueryParams(__all_params);
    var __mapped_params = __filtered_params.map(function(__filtered_param){
        return __filtered_param.name+'='+encodeURIComponent(eval(__filtered_param.path));
    });
    return __filtered_params.length>0?'?'+__mapped_params.join('&'):'';
}
var REST_REQUEST_URI = encodeURI('/v1/customers/') + encodeURIComponent(REST_PATH_customerId);

// Set request fields.
REST_REQUEST.setHeader('Content-Type','application/json');
REST_REQUEST.setHeader('Accept','application/json');
REST_REQUEST.setUrl(REST_REQUEST_URI);
REST_REQUEST.setMethod('GET');
if (REST_PAYLOAD) {
    REST_REQUEST.setData(REST_PAYLOAD);
}


]]></tibex:restRequestScript>
            <bpws:documentation>Retrieve customer data.</bpws:documentation>
            <bpws:targets>
                <bpws:target linkName="StartEvent to GetcustomerGETCustomers"/>
            </bpws:targets>
            <bpws:sources>
                <bpws:source linkName="GetcustomerGETCustomers to EmailCustomers"/>
            </bpws:sources>
        </bpws:invoke>
        <bpws:empty name="EndEvent" tibex:migrationAllowed="yes"
            tibex:type="endEvent" tibex:xpdlId="_c5zCRIHzEemwcs8vYEbmtg">
            <bpws:targets>
                <bpws:target linkName="EmailCustomers to EndEvent"/>
            </bpws:targets>
        </bpws:empty>
        <bpws:extensionActivity>
            <tibex:extActivity name="EmailCustomers"
                tibex:migrationAllowed="yes" tibex:type="serviceTask"
                tibex:xpdlId="_uzdaEIXmEemreJ7fmIXVPg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="GetcustomerGETCustomers to EmailCustomers"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="EmailCustomers to EndEvent"/>
                </bpws:sources>
                <bxst:Email connectionResource="CustomerReps"
                    xmi:version="2.0"
                    xmlns:bxst="http://www.tibco.com/bpel/2007/extensions/email" xmlns:xmi="http://www.omg.org/XMI">
                    <correspondents>
                        <from value="%TextProcField%">
                            <variables name="%TextProcField%"/>
                        </from>
                        <to value="me@work.com"/>
                        <cc/>
                        <bcc/>
                        <replyTo/>
                    </correspondents>
                    <headers/>
                    <priority value="High"/>
                    <subject value="Help"/>
                    <body>
                        <body value="WTF"/>
                    </body>
                    <server>
                        <host value="A-SERVER-SETTING"/>
                    </server>
                </bxst:Email>
            </tibex:extActivity>
        </bpws:extensionActivity>
    </bpws:flow>
</bpws:process>
