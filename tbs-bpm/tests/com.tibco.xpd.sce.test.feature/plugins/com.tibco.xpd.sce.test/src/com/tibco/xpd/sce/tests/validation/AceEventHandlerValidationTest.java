/**
 * Copyright (c) TIBCO Software Inc 2004-2024. All rights reserved.
 */
package com.tibco.xpd.sce.tests.validation;

import org.eclipse.core.resources.IFile;

import com.tibco.xpd.core.test.util.TestResourceInfo;
import com.tibco.xpd.core.test.validations.ValidationsTestProblemMarkerInfo;
import com.tibco.xpd.n2.test.core.validation.AbstractN2BaseValidationTest;
import com.tibco.xpd.resources.util.WorkingCopyUtil;
import com.tibco.xpd.xpdExtension.ActivityRef;
import com.tibco.xpd.xpdExtension.EventHandlerInitialisers;
import com.tibco.xpd.xpdExtension.XpdExtensionPackage;
import com.tibco.xpd.xpdl2.Activity;
import com.tibco.xpd.xpdl2.Package;
import com.tibco.xpd.xpdl2.Process;
import com.tibco.xpd.xpdl2.resources.Xpdl2WorkingCopyImpl;
import com.tibco.xpd.xpdl2.util.Xpdl2ModelUtil;

/**
 * Sid ACE-6836 AceEventHandlerValidationTest
 * <p>
 * AceEventHandlerValidationTest - Test selected validations are correctly raised.
 * </p>
 * <p>
 * Generated by: createBaseTest.javajet
 * </p>
 *
 * Test BPMe event handler and event sub-process related validation rules and quick fixes
 *
 * @author
 * @since
 */
public class AceEventHandlerValidationTest extends AbstractN2BaseValidationTest {

	private static final String EventHandlerInitialisers = null;

	public AceEventHandlerValidationTest() {
		super(true);
	}

	/**
     * AceEventHandlerValidationTest
     * 
     * @throws Exception
     */
    public void testAceEventHandlerValidationTest() throws Exception {
		doTestValidations();

		/*
		 * Check that quick fixes retained original correlation configuration moved from Message events to Incoming
		 * request events.
		 */
		IFile testFile = getTestFile("TestEventHandlerCorrelation.xpdl"); //$NON-NLS-1$
		Xpdl2WorkingCopyImpl wc = (Xpdl2WorkingCopyImpl) WorkingCopyUtil.getWorkingCopy(testFile);
		com.tibco.xpd.xpdl2.Package pkg = (Package) wc.getRootElement();

		Process process = pkg.getProcess("_p3oPoLugEe6ftJOirKXV8g"); //$NON-NLS-1$

		/*
		 * EventHandlerMessageTrigger
		 */
		Activity activity = Xpdl2ModelUtil.getActivityByName(process, "EventHandlerMessageTrigger"); //$NON-NLS-1$
		checkContainsInitialiserActivities(activity,
				new String[]{"_vpSFMbugEe6ftJOirKXV8g", "_ugtTkbugEe6ftJOirKXV8g"});

		/*
		 * EventSubprocessMessageTrigger
		 */
		activity = Xpdl2ModelUtil.getActivityByName(process, "EventSubprocessMessageTrigger"); //$NON-NLS-1$
		checkContainsInitialiserActivities(activity,
				new String[]{"_vpSFMbugEe6ftJOirKXV8g"});

        return;
	}

	/**
	 * Check that the event handler has the given set of correlation data initialiser activities configured.
	 * 
	 * @param incomingRequestEvent
	 * @param initialiserActivityIds
	 */
	private void checkContainsInitialiserActivities(Activity incomingRequestEvent,
			String[] initialiserActivityIds)
	{
		EventHandlerInitialisers initialisers = (EventHandlerInitialisers) Xpdl2ModelUtil.getOtherElement(
				incomingRequestEvent,
				XpdExtensionPackage.eINSTANCE.getDocumentRoot_EventHandlerInitialisers());

		assertNotNull(initialisers);
		assertEquals(initialiserActivityIds.length, initialisers.getActivityRef().size());

		for (String initialiserActivityId : initialiserActivityIds)
		{
			boolean found = false;

			for (ActivityRef activityRef : initialisers.getActivityRef())
			{
				if (initialiserActivityId.equals(activityRef.getIdRef()))
				{
					found = true;
					break;
				}
			}

			if (!found)
			{
				fail(String.format("Initializer activity '%s' is missing from event-handler '%s'",
						initialiserActivityId, incomingRequestEvent.getName()));
			}
		}
	}

	@Override
    protected ValidationsTestProblemMarkerInfo[] getValidationProblemMarkerInfos() {
        ValidationsTestProblemMarkerInfo[] markerInfos = new ValidationsTestProblemMarkerInfo[] { 
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bpmn.dev.eventHandlerCorrelationDataInitializeActivitiesMissing", //$NON-NLS-1$ 
			    		"_1mV5gLugEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : 1 of the Event Handler's selected activities for initialization are no longer present. (TestEventHandlerCorrelationProcess:EventHandlerDeletedInitializerActivity)", //$NON-NLS-1$ 
			    		"Remove references to any Event Handler initializers that cannot be resolved."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bpmn.dev.eventHandlerCorrelationDataInitializeActivityConstraint", //$NON-NLS-1$ 
			    		"_bavWCLulEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Event handlers cannot be initialized after activity 'Attachedevent'. (TestEventHandlerCorrelationProcess:EventSubProcess4:EventSubprocessInvalidinitializeractivity)", //$NON-NLS-1$ 
			    		"Remove references to any Event Handler initializers that cannot be resolved."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bpmn.dev.eventHandlerCorrelationDataInitialization", //$NON-NLS-1$ 
			    		"_e_NfILuhEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Event-handlers must be initialized only after the correlation field 'CorrelationField' is assigned in the main process flow. Use the 'Event Handler->Initializers' configuration to specify the activity(s) that set the correlation data.  (TestEventHandlerCorrelationProcess:EventSubProcess:EventSubprocessNoinitializersdefined)", //$NON-NLS-1$ 
			    		"Explicitly initialize Event Handler after start activities (you should assign correlation data in their Complete scripts)."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bpmn.dev.eventHandlerCorrelationDataInitialization", //$NON-NLS-1$ 
			    		"_e_NfILuhEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Event-handlers must be initialized only after the correlation field 'CorrelationField2' is assigned in the main process flow. Use the 'Event Handler->Initializers' configuration to specify the activity(s) that set the correlation data.  (TestEventHandlerCorrelationProcess:EventSubProcess:EventSubprocessNoinitializersdefined)", //$NON-NLS-1$ 
			    		"Explicitly initialize Event Handler after start activities (you should assign correlation data in their Complete scripts)."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bpmn.dev.eventHandlerCorrelationDataInitializeActivitiesMissing", //$NON-NLS-1$ 
			    		"_rAeRl7uhEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : 1 of the Event Handler's selected activities for initialization are no longer present. (TestEventHandlerCorrelationProcess:EventSubProcess3:EventSubprocessDeletedinitializeractivity)", //$NON-NLS-1$ 
			    		"Remove references to any Event Handler initializers that cannot be resolved."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bpmn.dev.eventHandlerCorrelationDataInitializeActivityConstraint", //$NON-NLS-1$ 
			    		"_tekZ0rujEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Event handlers cannot be initialized after activity 'Attachedevent'. (TestEventHandlerCorrelationProcess:EventHandlerInvalidinitializeractivity)", //$NON-NLS-1$ 
			    		"Remove references to any Event Handler initializers that cannot be resolved."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"ace.incoming.message.event.not.supported", //$NON-NLS-1$ 
			    		"_TrTlLbulEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Incoming web-service message are not supported. Use 'Incoming Request' events/tasks instead and invoke these thru run-time API if required. (TestEventHandlerCorrelationProcess:EventSubProcess2:EventSubprocessMessageTrigger)", //$NON-NLS-1$ 
			    		"Set to trigger type 'Start Request'."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bx.eventSubProcStartEventTriggerTypeRestrictionInBusinessProc", //$NON-NLS-1$ 
			    		"_TrTlLbulEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Only incoming-request / catch-signal event sub-processes are supported in Business Processes. (TestEventHandlerCorrelationProcess:EventSubProcess2:EventSubprocessMessageTrigger)", //$NON-NLS-1$ 
			    		"Set to trigger type 'Start Request'."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"ace.incoming.message.event.not.supported", //$NON-NLS-1$ 
			    		"_U7BddLuhEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Incoming web-service message are not supported. Use 'Incoming Request' events/tasks instead and invoke these thru run-time API if required. (TestEventHandlerCorrelationProcess:EventHandlerMessageTrigger)", //$NON-NLS-1$ 
			    		"Set to trigger type 'Incoming Request'."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bx.eventHandlersMustBeCatchMessageOrSignal", //$NON-NLS-1$ 
			    		"_U7BddLuhEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Only incoming-request/catch-signal/catch-cancel type event handlers are supported in Business Processes. (TestEventHandlerCorrelationProcess:EventHandlerMessageTrigger)", //$NON-NLS-1$ 
			    		"Set to trigger type 'Incoming Request'."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bpmn.dev.eventHandlerCorrelationDataInitialization", //$NON-NLS-1$ 
			    		"_xP_kULugEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Event-handlers must be initialized only after the correlation field 'CorrelationField' is assigned in the main process flow. Use the 'Event Handler->Initializers' configuration to specify the activity(s) that set the correlation data.  (TestEventHandlerCorrelationProcess:EventHandlerNoInitializersdefined)", //$NON-NLS-1$ 
			    		"Explicitly initialize Event Handler after start activities (you should assign correlation data in their Complete scripts)."), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/TestEventHandlerCorrelation/Process Packages/TestEventHandlerCorrelation.xpdl", //$NON-NLS-1$ 
			    		"bpmn.dev.eventHandlerCorrelationDataInitialization", //$NON-NLS-1$ 
			    		"_xP_kULugEe6ftJOirKXV8g", //$NON-NLS-1$ 
			    		"BPM  : Event-handlers must be initialized only after the correlation field 'CorrelationField2' is assigned in the main process flow. Use the 'Event Handler->Initializers' configuration to specify the activity(s) that set the correlation data.  (TestEventHandlerCorrelationProcess:EventHandlerNoInitializersdefined)", //$NON-NLS-1$ 
			    		"Explicitly initialize Event Handler after start activities (you should assign correlation data in their Complete scripts)."), //$NON-NLS-1$ 
			    		
			                
        };
        return markerInfos;
    }

    @Override
    protected String getTestName() {
        return "AceEventHandlerValidationTest"; //$NON-NLS-1$
    }

    @Override
    protected String getTestPlugInId() {
        return "com.tibco.xpd.sce.test"; //$NON-NLS-1$
    }

    @Override
    protected TestResourceInfo[] getTestResources() {
        TestResourceInfo[] testResources = new TestResourceInfo[] {
            new TestResourceInfo("resources/AceEventHandlerValidationTest", "TestEventHandlerCorrelation/Process Packages{processes}/TestEventHandlerCorrelation.xpdl"), //$NON-NLS-1$ //$NON-NLS-2$
            new TestResourceInfo("resources/AceEventHandlerValidationTest", "TestEventHandlerCorrelation/Process Packages{processes}/TestEventHandlerCorrelation.xpdl"), //$NON-NLS-1$ //$NON-NLS-2$
            new TestResourceInfo("resources/AceEventHandlerValidationTest", "TestEventHandlerCorrelation/Process Packages{processes}/TestEventHandlerCorrelation.xpdl"), //$NON-NLS-1$ //$NON-NLS-2$
        };
    
        return testResources;
    }

}
