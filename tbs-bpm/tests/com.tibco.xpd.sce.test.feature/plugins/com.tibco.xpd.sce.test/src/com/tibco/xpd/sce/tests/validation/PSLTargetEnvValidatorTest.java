/**
 * Copyright (c) TIBCO Software Inc 2004-2009. All rights reserved.
 */
package com.tibco.xpd.sce.tests.validation;

import org.eclipse.core.resources.ResourcesPlugin;

import com.tibco.xpd.core.test.util.TestResourceInfo;
import com.tibco.xpd.core.test.util.TestUtil;
import com.tibco.xpd.core.test.validations.ValidationsTestProblemMarkerInfo;
import com.tibco.xpd.n2.test.core.validation.AbstractN2BaseValidationTest;
import com.tibco.xpd.resources.util.ProjectImporter;

/**
 * ACE-7402: PSLTargetEnvValidatorTest
 * <p>
 * PSLTargetEnvValidatorTest - Test selected validations are correctly raised.
 * </p>
 * <p>
 * Generated by: createBaseTest.javajet
 * </p>
 *
 * Check that scripts are valid for the selected target environment. Test resource project has PSLInvalidTargetPrj.psl
 * file. PSL file has 3 functions named 'AnyFn', 'ProcessMgFn' and 'WorkMgrFn'. Each functions has following script
 * 
 * <p>
 * 
 * <pre>
 * bpm.process.getDescription();
 * bpm.workManager.getOrgModel();
 *
 * return true;
 * </pre>
 * <p>
 *
 * Depending on the target environment, validations are raised accordingly.
 * 
 * Test also imports a valid project which should not raise any validation related to target environment.
 * 
 * @author ssirsika
 * @since 05 Apr 2024
 */

public class PSLTargetEnvValidatorTest extends AbstractN2BaseValidationTest
{

	public PSLTargetEnvValidatorTest() {
		super(true);
	}

	/**
	 * PSLTargetEnvValidatorTest
	 * 
	 * @throws Exception
	 */
	public void testPSLTargetEnvValidatorTest() throws Exception
	{
		doTestValidations();

		/*
		 * Project with valid target environment configuration for process and work manager - so should have no
		 * problems.
		 */
		assertFalse("PSLValidTargetPrj" //$NON-NLS-1$
				+ " project should not have any ERROR level problem markers", //$NON-NLS-1$
				TestUtil.hasErrorProblemMarker(
						ResourcesPlugin.getWorkspace().getRoot().getProject("PSLValidTargetPrj"), true, //$NON-NLS-1$
						"testPSLTargetEnvValidatorTest")); //$NON-NLS-1$
	}

	@Override
    protected ValidationsTestProblemMarkerInfo[] getValidationProblemMarkerInfos() {
		return new ValidationsTestProblemMarkerInfo[]{
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/PSLInvalidTargetPrj/Process Script Library/PSLInvalidTargetPrj.psl", //$NON-NLS-1$ 
			    		"bx.validateScriptTask", //$NON-NLS-1$ 
			    		"_5thZEvL9Ee6EX8CPBg4ixQ", //$NON-NLS-1$ 
			    		"BPM  : At Line:1 column:29, Property process is invalid for the current context (PSLInvalidTargetPrj:AnyFn)", //$NON-NLS-1$ 
			    		""), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/PSLInvalidTargetPrj/Process Script Library/PSLInvalidTargetPrj.psl", //$NON-NLS-1$ 
			    		"bx.validateScriptTask", //$NON-NLS-1$ 
			    		"_5thZEvL9Ee6EX8CPBg4ixQ", //$NON-NLS-1$ 
			    		"BPM  : At Line:2 column:30, Property workManager is invalid for the current context (PSLInvalidTargetPrj:AnyFn)", //$NON-NLS-1$ 
			    		""), //$NON-NLS-1$ 
			    		
			
			    new ValidationsTestProblemMarkerInfo(
			    		"/PSLInvalidTargetPrj/Process Script Library/PSLInvalidTargetPrj.psl", //$NON-NLS-1$ 
						"bx.validateScriptTask", //$NON-NLS-1$
						"__1yX0PL9Ee6EX8CPBg4ixQ", //$NON-NLS-1$
						"BPM  : At Line:2 column:30, Property workManager is invalid for the current context (PSLInvalidTargetPrj:ProcessMgFn)", //$NON-NLS-1$
						""), //$NON-NLS-1$

			
			    new ValidationsTestProblemMarkerInfo(
			    		"/PSLInvalidTargetPrj/Process Script Library/PSLInvalidTargetPrj.psl", //$NON-NLS-1$ 
			    		"bx.validateScriptTask", //$NON-NLS-1$ 
			    		"_BcBV0PL-Ee6EX8CPBg4ixQ", //$NON-NLS-1$ 
			    		"BPM  : At Line:1 column:29, Property process is invalid for the current context (PSLInvalidTargetPrj:WorkMgrFn)", //$NON-NLS-1$ 
			    		""), //$NON-NLS-1$ 
			    		
			   

        };
    }

    @Override
    protected String getTestName() {
		return "PSLTargetEnvValidatorTest"; //$NON-NLS-1$
    }

    @Override
    protected String getTestPlugInId() {
		return "com.tibco.xpd.sce.test"; //$NON-NLS-1$
    }

	/**
	 * @see com.tibco.xpd.core.test.util.AbstractBaseResourceTest#customTestResourceSetup()
	 *
	 */
	@Override
	protected void customTestResourceSetup()
	{

		// Import project which should not have any problem markers after the validation
		ProjectImporter projectImporter = TestUtil.importProjectsFromZip("com.tibco.xpd.sce.test", //$NON-NLS-1$
				new String[]{"resources/PSLTargetEnvValidatorTest/PSLValidTargetPrj/"}, //$NON-NLS-1$
				new String[]{"PSLValidTargetPrj"}); // $NON-NLS-1$ //$NON-NLS-1$

		assertTrue("Failed to load projects from \"resources/PSLTargetEnvValidatorTest\"", //$NON-NLS-1$
				projectImporter != null);

	}

    @Override
    protected TestResourceInfo[] getTestResources() {
		return new TestResourceInfo[]{
				new TestResourceInfo("resources/PSLTargetEnvValidatorTest", //$NON-NLS-1$
						"PSLInvalidTargetPrj/Process Script Library{psl}/PSLInvalidTargetPrj.psl") //$NON-NLS-1$
        };
    }

}
